"use strict";var e=require("@babel/runtime/helpers/interopRequireWildcard"),r=require("@babel/runtime/helpers/interopRequireDefault"),c=r(require("@babel/runtime/regenerator")),n=r(require("@babel/runtime/helpers/asyncToGenerator")),t=require("typeorm"),l=e(require("fastify")),s=r(require("fs")),f=require("./utils/decorator"),o=require("./controller"),p=require("./utils/tool");(0,t.createConnection)().then(function(){var r=(0,n.default)(c.default.mark(function _callee(r){var n,o,i,u,t,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=(0,l.default)({logger:!0}).register(require("point-of-view"),{engine:{ejs:require("ejs")},templates:"./views"})).log.info("loading..."),o=[],i=!0,e.next=6,s.default.readFileSync("./ormconfig.json",function(e){if(e)return console.error(e)});case 6:for(a in u=e.sent,u=JSON.parse(u.toString()).database,s.default.readdirSync(__dirname+"/controller").forEach(function(e){require(__dirname+"/controller/"+e),o.push(e)}),t=function(n){var t={};r.query("SELECT COLUMN_NAME, DATA_TYPE FROM INFORMATION_SCHEMA.COLUMNS\n    WHERE table_name = '".concat(o[n].replace(/(\w*)[A-Z]\w*\.js/,"$1").toLocaleLowerCase(),"'\n    AND table_schema = '").concat(u,"'"),function(e,r){r.forEach(function(e){Object.defineProperty(t,e.COLUMN_NAME,{enumerable:!0,configurable:!1,value:{type:(0,p.sqlCheck)(e.DATA_TYPE)}})}),f.Routes.forEach(function(e){e.c.name+".js"===o[n]&&(e.p=t)}),n==o.length-1&&(i=!1),t=null})},o)t(a);return e.next=13,function fff(){setTimeout(function(){return i?fff():(f.Routes.forEach(function(t){var e={schema:{response:{200:{type:t.s,properties:t.p}}}};t.w&&(e.preHandler=t.w),n[t.m](t.r,e,function(e,r){var n=(new t.c)[t.a](e,r);n instanceof Promise&&n.then(function(e){return null!=e?r.send(e):void 0})})}),n.listen(3e3,function(e){if(e)throw e;console.log("FastifyServer http://localhost:3000 to see")}),void(o=null))},10)}();case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},_callee)}));return function(e){return r.apply(this,arguments)}}()).catch(function(e){return console.error("TypeORM connection error: ",e)});