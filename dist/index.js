"use strict";var e=require("@babel/runtime/helpers/interopRequireWildcard"),r=require("@babel/runtime/helpers/interopRequireDefault"),u=r(require("@babel/runtime/regenerator")),t=r(require("@babel/runtime/helpers/asyncToGenerator")),n=require("typeorm"),c=e(require("fastify")),l=r(require("fs")),s=require("./utils/decorator"),o=require("./controller"),f=require("./utils/tool");(0,n.createConnection)().then(function(){var r=(0,t.default)(u.default.mark(function _callee(n){var r,t,o,i,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=(0,c.default)({logger:!1}).register(require("point-of-view"),{engine:{ejs:require("ejs")},templates:"./views"})).log.info("loading..."),t=[],o={},global.ONCE=!0,e.next=6,l.default.readdirSync(__dirname+"/controller").forEach(function(e){require(__dirname+"/controller/"+e),t.push(e)});case 6:return e.next=8,l.default.readdirSync(__dirname+"/entity").forEach(function(e){var r={},t=require(__dirname+"/entity/"+e);n.getRepository(t[Object.keys(t)[0]]).metadata.ownColumns.forEach(function(e){Object.defineProperty(r,e.propertyName,{enumerable:!0,configurable:!1,value:{type:(0,f.sqlCheck)(e.type)}})}),o[e]=r,r=null});case 8:for(a in i=function(r){s.Routes.forEach(function(e){e.c.name+".js"===t[r]&&(void 0===e.p.result?e.p=o[e.c.name.replace(/(\w*)[A-Z]\w*/,"$1")+".js"]:e.p.result={type:"object",properties:o[e.c.name.replace(/(\w*)[A-Z]\w*/,"$1")+".js"]})}),r==t.length-1&&0},t)i(a);s.Routes.forEach(function(t){var e={schema:{response:{200:{type:t.s,properties:t.p}}}};t.w&&(e.preHandler=t.w),r[t.m](t.r,e,function(e,r){return(new t.c)[t.a](e,r)})}),r.listen(3e3,function(e){if(e)throw e;console.log("FastifyServer http://localhost:3000 to see")}),o=t=null;case 14:case"end":return e.stop()}},_callee)}));return function(e){return r.apply(this,arguments)}}()).catch(function(e){return console.error("TypeORM connection error: ",e)});